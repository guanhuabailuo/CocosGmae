"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebHandle = void 0;
const path_1 = require("path");
function parseErrorLine(err) {
    if (!err || !(err instanceof Error) || !err.stack) {
        return '[-]';
    }
    const stack = err.stack;
    const stackArr = stack.split('\n');
    let callerLogIndex = (stackArr.length > 0) ? 1 : 0;
    // for (let i = 0; i < stackArr.length; i++) {
    //     if (stackArr[i].indexOf('makeError') > 0 && i + 1 < stackArr.length) {
    //         callerLogIndex = i + 1;
    //         break;
    //     }
    // }
    if (callerLogIndex !== 0) {
        const callerStackLine = stackArr[callerLogIndex];
        let list = callerStackLine.split(/\(|\)/);
        if (list[1] && list[1].length > 0) {
            return `[${list[1].replace(process.cwd(), '').replace(/\\/g, "/").replace('/', '')}]`;
        }
        else {
            return `[${callerStackLine.substring(callerStackLine.lastIndexOf(path_1.sep) + 1, callerStackLine.lastIndexOf(':'))}]`;
        }
    }
    else {
        return '[-]';
    }
}
class HandleUnit {
    constructor(symbol) {
        this.routeMap = {};
        this.beforeList = [];
        this.afterList = [];
        this.symbol = symbol || Symbol();
    }
    paramsCheck(checkMap, params) {
        if (checkMap == undefined)
            return;
        for (let key in checkMap) {
            let cfg = checkMap[key];
            if (cfg.required && !params.hasOwnProperty(key)) {
                // 这里没找到 抛出一个异常
                throw Error(`param [${key} required and type limit ${cfg.type}]`);
            }
            else if (!params.hasOwnProperty(key)) {
                continue;
            }
            if (cfg.type == typeof params[key]) {
                continue;
            }
            // 这里类型不同
            if (!cfg.change) {
                throw Error(`param [${key} type limit ${cfg.type}]`);
            }
            else {
                switch (cfg.type) {
                    case "bigint":
                        params[key] = BigInt(params[key]);
                        break;
                    case "boolean": {
                        if (params[key] == true || params[key] == "true") {
                            params[key] = true;
                        }
                        else {
                            params[key] = false;
                        }
                        // params[key] = Boolean(params[key]);
                        break;
                    }
                    case "function": throw Error(`param [${key} type limit ${cfg.type}]`);
                    case "number":
                        params[key] = Number(params[key]);
                        // 这里增加一个小优化 ，如果是整数那么直接转换成整数
                        if (params[key] = parseInt(params[key])) {
                            params[key] = parseInt(params[key]);
                        }
                        break;
                    case "object":
                        params[key] = JSON.parse(params[key].toString());
                        break;
                    case "string":
                        params[key] = String(params[key]);
                        break;
                    case "symbol":
                        params[key] = Symbol(params[key]);
                        break;
                    default: break;
                }
            }
        }
    }
    // 调用接口
    getRouteFunc(Name, req) {
        let routeObj = this.routeMap[Name];
        if (!routeObj) {
            return undefined;
        }
        this.paramsCheck(routeObj.params, req.params);
        return routeObj.value.bind(routeObj.target, req.params, req.method.toUpperCase(), req.headers, req);
    }
    /**
     * 调用模块
     * @param pathlist
     * @param req
     * @param res
     * @param next
     */
    route(Name, req, res, next) {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                let routeFunc = this.getRouteFunc(Name, req);
                if (!routeFunc) {
                    req.responseData = {
                        code: -1,
                        errMsg: "can not find [" + req.path + "]"
                    };
                    return true;
                }
                // 这里开始调用响应
                req.responseData = yield routeFunc();
                if (req.responseData == undefined) {
                    req.responseData = { code: 0 };
                }
            }
            catch (e) {
                if (!e) {
                    req.responseData = {
                        code: -1,
                        errMsg: "error bug no message"
                    };
                }
                else if (typeof e == 'string') {
                    req.responseData = e;
                }
                else if (e instanceof Error) {
                    req.responseData = {
                        code: -1,
                        errMsg: e.message,
                        __line__: parseErrorLine(e)
                    };
                }
                else {
                    req.responseData = e;
                }
            }
            return true;
        });
    }
    /**
    * 调用模块
    * @param pathlist
    * @param req
    * @param res
    * @param next
    */
    before(req, res) {
        return __awaiter(this, void 0, void 0, function* () {
            for (let i = 0; i < this.beforeList.length; i++) {
                let routeMap = this.beforeList[i];
                try {
                    this.paramsCheck(routeMap.params, req.params);
                    yield routeMap.value.apply(routeMap.target, [req, res]);
                }
                catch (e) {
                    // 出钱异常的化
                    if (!e) {
                        req.responseData = {
                            code: -1,
                            errMsg: "error bug no message"
                        };
                    }
                    else if (typeof e == 'string') {
                        req.responseData = e;
                    }
                    else if (e instanceof Error) {
                        req.responseData = {
                            code: -1,
                            errMsg: e.message,
                            __line__: parseErrorLine(e)
                        };
                    }
                    else {
                        req.responseData = e;
                    }
                    return false;
                }
            }
            return true;
        });
    }
    /**
    * 调用模块
    * @param pathlist
    * @param req
    * @param res
    * @param next
    */
    after(req, res) {
        return __awaiter(this, void 0, void 0, function* () {
            for (let i = 0; i < this.afterList.length; i++) {
                let routeMap = this.afterList[i];
                try {
                    this.paramsCheck(routeMap.params, req.params);
                    yield routeMap.value.apply(routeMap.target, [req, res]);
                }
                catch (e) {
                    // 出钱异常的化
                    if (!e) {
                        req.responseData = {
                            code: -1,
                            errMsg: "error bug no message"
                        };
                    }
                    else if (typeof e == 'string') {
                        req.responseData = e;
                    }
                    else if (e instanceof Error) {
                        req.responseData = {
                            code: -1,
                            errMsg: e.message,
                            __line__: parseErrorLine(e)
                        };
                    }
                    else {
                        req.responseData = e;
                    }
                    return false;
                }
            }
            return true;
        });
    }
}
class HandleMap {
    constructor(type) {
        this.routeMap = {};
        this.type = type;
    }
    mergeModule(fileRoute) {
        // this.routeMap[prePath].routeMap = Object.assign(this.routeMap[prePath].routeMap, this.currNode.routeMap)
        // if (this.currNode.afterList) this.routeMap[prePath].afterList.push(...this.currNode.afterList)
        // if (this.currNode.beforeList) this.routeMap[prePath].beforeList.push(...this.currNode.beforeList)
        for (let key in this.routeMap) {
            let file = key;
            let mmap = this.routeMap[key];
            // 判断一下是全路径的还是相对地址的
            if (file.indexOf(fileRoute) < 0)
                continue;
            // 这里改成相对地址的模块
            let nKey = key.replace(fileRoute, "/");
            let n = this.getModule(nKey);
            n.routeMap = Object.assign(mmap.routeMap, n.routeMap);
            if (mmap.afterList)
                n.afterList.push(...mmap.afterList);
            if (mmap.beforeList)
                n.beforeList.push(...mmap.beforeList);
            delete this.routeMap[key];
        }
        this.mainPath = fileRoute;
    }
    hasModule(prePath) {
        if (this.routeMap[prePath])
            true;
        return false;
    }
    formateRoute(prePath) {
        prePath = prePath.replace(/\\/g, "/");
        if (this.mainPath) {
            prePath = prePath.replace(this.mainPath, "/");
        }
        prePath = prePath.replace(/\/\//g, "/");
        if (prePath == undefined || prePath == null || prePath == "")
            prePath = "/";
        if (prePath[0] != "/")
            prePath = "/" + prePath;
        // if (prePath.charAt(0) != "/") prePath = "/" + prePath;
        return prePath;
    }
    getModule(prePath) {
        prePath = this.formateRoute(prePath);
        if (!this.routeMap[prePath])
            this.routeMap[prePath] = new HandleUnit();
        return this.routeMap[prePath];
    }
    _chechMethod(target) {
        if (!this.currNode)
            this.currNode = new HandleUnit();
        if (!target.___symbol)
            target.___symbol = this.currNode.symbol;
        if (target.___symbol != this.currNode.symbol) {
            // 表示注册的不是当前class的模块了，需要替换
            this.currNode = new HandleUnit;
        }
    }
    /**
     * 设置模块的归属
     */
    class(prePath) {
        return (target) => {
            if (prePath == undefined)
                prePath = target.name;
            if (typeof prePath != "string") {
                let pd = path_1.parse(prePath.filename);
                if (pd.name == "index") {
                    prePath = pd.dir;
                }
                else {
                    prePath = path_1.join(pd.dir, pd.name);
                }
            }
            prePath = this.formateRoute(prePath);
            if (!this.currNode)
                return;
            // 这里负责把当前注册的节点添加到目标节点库中
            if (this.routeMap[prePath]) {
                // 这里需要合并
                this.routeMap[prePath].routeMap = Object.assign(this.routeMap[prePath].routeMap, this.currNode.routeMap);
                if (this.currNode.afterList)
                    this.routeMap[prePath].afterList.push(...this.currNode.afterList);
                if (this.currNode.beforeList)
                    this.routeMap[prePath].beforeList.push(...this.currNode.beforeList);
                this.currNode = undefined;
            }
            else {
                this.routeMap[prePath] = this.currNode;
                this.currNode = undefined;
            }
        };
    }
    methodPrepare(descriptor) {
        if (!descriptor.params)
            descriptor.params = {};
    }
    /**
    * 注册路由
    */
    route(Name) {
        return (target, name, descriptor) => {
            this._chechMethod(target);
            this.methodPrepare(descriptor);
            if (Name == undefined && typeof name == "string")
                Name = name;
            if (Name == undefined || descriptor.value == undefined)
                return;
            if (this.currNode)
                this.currNode.routeMap[Name] = {
                    target: target,
                    value: descriptor.value,
                    params: descriptor.params
                };
        };
    }
    /**
    * 检查路由参数 如果调用了那么就给这个函数增加一个参数检查的标识，否则就不处理
    */
    params(pName, pType, required, change) {
        return (target, name, descriptor) => {
            this.methodPrepare(descriptor);
            this._chechMethod(target);
            if (!this.currNode || !descriptor.params) {
                // 理论上不会进入这里的
                return;
            }
            if (typeof name == "string") {
                descriptor.params[pName] = { type: pType, required: required, change: change };
            }
            else {
                // 这里如果传入的是 symbol 那么就比较难受了
                console.warn(`params check error on func ${name.toString()} ${pName} ${pType}`);
            }
        };
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    before() {
        return (target, name, descriptor) => {
            this.methodPrepare(descriptor);
            this._chechMethod(target);
            if (descriptor.value && this.currNode)
                this.currNode.beforeList.push({
                    target: target,
                    params: descriptor.params || {},
                    value: descriptor.value
                });
        };
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    after() {
        return (target, name, descriptor) => {
            this.methodPrepare(descriptor);
            this._chechMethod(target);
            if (descriptor.value && this.currNode)
                this.currNode.afterList.push({
                    target: target,
                    params: descriptor.params || {},
                    value: descriptor.value
                });
        };
    }
}
class WebHandle {
    constructor() {
        this.mainPath = "";
        this.globalMap = new HandleMap("global");
        this.envMap = new HandleMap("env");
        this.routeMap = new HandleMap("route");
        // 当前的环境
        this._env = "";
    }
    init(mainPath, env) {
        this.mainPath = mainPath.replace(/\\/g, "/");
        this.setEnv(env || "");
        // 合并一下啊各种模块
        this.routeMap.mergeModule(this.mainPath);
    }
    /**
    * 设置模块的归属
    */
    class(prePath) {
        return this.routeMap.class(prePath);
    }
    /**
     * 注册路由
     */
    route(Name) {
        return this.routeMap.route(Name);
    }
    /**
     * 注册参数检查
     */
    params(Name, type, required, change) {
        return this.routeMap.params(Name, type, required, change);
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    before() {
        return this.routeMap.before();
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    after() {
        return this.routeMap.after();
    }
    /**
     * 获取一个响应模块
     * @param prePath 可以设置相对路径字符串，或者模块对象
     */
    getModule(prePath) {
        if (typeof prePath != "string") {
            prePath = prePath.filename;
        }
        return this.routeMap.getModule(prePath);
    }
    getEnvModule() {
        return this.envMap.getModule(this.getEnv());
    }
    getGlobalModule() {
        return this.globalMap.getModule("");
    }
    /**
     * 设置当前环境 （主要是提供给处理方法调用环境判断）
     * @param env 环境参数
     */
    setEnv(env) {
        this._env = env;
    }
    /**
     * 获取当前环境
     */
    getEnv() {
        if (typeof this._env == "function") {
            return this._env();
        }
        else {
            return this._env;
        }
    }
    /**
     * 设置模块的归属
     */
    envClass(prePath) {
        return this.envMap.class(prePath);
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    envBefore() {
        return this.envMap.before();
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    envAfter() {
        return this.envMap.after();
    }
    /**
     * 全局模块
     */
    globalClass() {
        return this.globalMap.class("");
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    globalBefore() {
        return this.globalMap.before();
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    globalAfter() {
        return this.globalMap.after();
    }
}
exports.WebHandle = WebHandle;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViSGFuZGxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2ViSGFuZGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUVBLCtCQUF3QztBQUd4QyxTQUFTLGNBQWMsQ0FBQyxHQUFVO0lBQzlCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsWUFBWSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUU7UUFDL0MsT0FBTyxLQUFLLENBQUE7S0FDZjtJQUVELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7SUFDeEIsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxJQUFJLGNBQWMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25ELDhDQUE4QztJQUM5Qyw2RUFBNkU7SUFDN0Usa0NBQWtDO0lBQ2xDLGlCQUFpQjtJQUNqQixRQUFRO0lBQ1IsSUFBSTtJQUVKLElBQUksY0FBYyxLQUFLLENBQUMsRUFBRTtRQUN0QixNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFXLENBQUM7UUFDM0QsSUFBSSxJQUFJLEdBQUcsZUFBZSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN6QyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMvQixPQUFPLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUE7U0FDeEY7YUFDSTtZQUNELE9BQU8sSUFBSSxlQUFlLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsVUFBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1NBQ25IO0tBQ0o7U0FBTTtRQUNILE9BQU8sS0FBSyxDQUFDO0tBQ2hCO0FBQ0wsQ0FBQztBQWNELE1BQU0sVUFBVTtJQUVaLFlBQVksTUFBZTtRQUkzQixhQUFRLEdBTUosRUFBRSxDQUFDO1FBQ1AsZUFBVSxHQUlKLEVBQUUsQ0FBQTtRQUNSLGNBQVMsR0FJSCxFQUFFLENBQUE7UUFuQkosSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLElBQUksTUFBTSxFQUFFLENBQUE7SUFDcEMsQ0FBQztJQXFCRCxXQUFXLENBQUMsUUFBNEIsRUFBRSxNQUE0QjtRQUNsRSxJQUFJLFFBQVEsSUFBSSxTQUFTO1lBQUUsT0FBTztRQUVsQyxLQUFLLElBQUksR0FBRyxJQUFJLFFBQVEsRUFBRTtZQUN0QixJQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDeEIsSUFBSSxHQUFHLENBQUMsUUFBUSxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDN0MsZUFBZTtnQkFDZixNQUFNLEtBQUssQ0FBQyxVQUFVLEdBQUcsNEJBQTRCLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFBO2FBQ3BFO2lCQUNJLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNsQyxTQUFTO2FBQ1o7WUFFRCxJQUFJLEdBQUcsQ0FBQyxJQUFJLElBQUksT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ2hDLFNBQVE7YUFDWDtZQUVELFNBQVM7WUFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRTtnQkFDYixNQUFNLEtBQUssQ0FBQyxVQUFVLEdBQUcsZUFBZSxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQTthQUN2RDtpQkFDSTtnQkFDRCxRQUFRLEdBQUcsQ0FBQyxJQUFJLEVBQUU7b0JBQ2QsS0FBSyxRQUFRO3dCQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQUMsTUFBTTtvQkFDeEQsS0FBSyxTQUFTLENBQUMsQ0FBQzt3QkFDWixJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sRUFBRTs0QkFDOUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQzt5QkFDdEI7NkJBQ0k7NEJBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQzt5QkFDdkI7d0JBQ0Qsc0NBQXNDO3dCQUN0QyxNQUFNO3FCQUNUO29CQUNELEtBQUssVUFBVSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsVUFBVSxHQUFHLGVBQWUsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7b0JBQ3RFLEtBQUssUUFBUTt3QkFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUM3Qyw0QkFBNEI7d0JBQzVCLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTs0QkFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTt5QkFDdEM7d0JBQ0QsTUFBTTtvQkFDVixLQUFLLFFBQVE7d0JBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7d0JBQUMsTUFBTTtvQkFDdkUsS0FBSyxRQUFRO3dCQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQUMsTUFBTTtvQkFDeEQsS0FBSyxRQUFRO3dCQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQUMsTUFBTTtvQkFDeEQsT0FBTyxDQUFDLENBQUMsTUFBTTtpQkFDbEI7YUFDSjtTQUNKO0lBQ0wsQ0FBQztJQUVELE9BQU87SUFDUCxZQUFZLENBQUMsSUFBWSxFQUFFLEdBQWM7UUFDckMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ1gsT0FBTyxTQUFTLENBQUM7U0FDcEI7UUFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQzdDLE9BQU8sUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLEVBQUUsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUN2RyxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0csS0FBSyxDQUFDLElBQVksRUFBRSxHQUFjLEVBQUUsR0FBYSxFQUFFLElBQWtCOztZQUN2RSxJQUFJO2dCQUNBLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO2dCQUM1QyxJQUFJLENBQUMsU0FBUyxFQUFFO29CQUNaLEdBQUcsQ0FBQyxZQUFZLEdBQUc7d0JBQ2YsSUFBSSxFQUFFLENBQUMsQ0FBQzt3QkFDUixNQUFNLEVBQUUsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHO3FCQUM1QyxDQUFBO29CQUNELE9BQU8sSUFBSSxDQUFDO2lCQUNmO2dCQUVELFdBQVc7Z0JBQ1gsR0FBRyxDQUFDLFlBQVksR0FBRyxNQUFNLFNBQVMsRUFBRSxDQUFBO2dCQUNwQyxJQUFJLEdBQUcsQ0FBQyxZQUFZLElBQUksU0FBUyxFQUFFO29CQUMvQixHQUFHLENBQUMsWUFBWSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFBO2lCQUNqQzthQUNKO1lBQ0QsT0FBTyxDQUFDLEVBQUU7Z0JBQ04sSUFBSSxDQUFDLENBQUMsRUFBRTtvQkFDSixHQUFHLENBQUMsWUFBWSxHQUFHO3dCQUNmLElBQUksRUFBRSxDQUFDLENBQUM7d0JBQ1IsTUFBTSxFQUFFLHNCQUFzQjtxQkFDakMsQ0FBQTtpQkFDSjtxQkFDSSxJQUFJLE9BQU8sQ0FBQyxJQUFJLFFBQVEsRUFBRTtvQkFDM0IsR0FBRyxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUE7aUJBQ3ZCO3FCQUNJLElBQUksQ0FBQyxZQUFZLEtBQUssRUFBRTtvQkFDekIsR0FBRyxDQUFDLFlBQVksR0FBRzt3QkFDZixJQUFJLEVBQUUsQ0FBQyxDQUFDO3dCQUNSLE1BQU0sRUFBRSxDQUFDLENBQUMsT0FBTzt3QkFDakIsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7cUJBQzlCLENBQUE7aUJBQ0o7cUJBQ0k7b0JBQ0QsR0FBRyxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7aUJBQ3hCO2FBQ0o7WUFFRCxPQUFPLElBQUksQ0FBQTtRQUNmLENBQUM7S0FBQTtJQUNEOzs7Ozs7TUFNRTtJQUNJLE1BQU0sQ0FBQyxHQUFjLEVBQUUsR0FBYTs7WUFDdEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUM3QyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNsQyxJQUFJO29CQUNBLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQzlDLE1BQU0sUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2lCQUMzRDtnQkFDRCxPQUFPLENBQUMsRUFBRTtvQkFDTixTQUFTO29CQUNULElBQUksQ0FBQyxDQUFDLEVBQUU7d0JBQ0osR0FBRyxDQUFDLFlBQVksR0FBRzs0QkFDZixJQUFJLEVBQUUsQ0FBQyxDQUFDOzRCQUNSLE1BQU0sRUFBRSxzQkFBc0I7eUJBQ2pDLENBQUE7cUJBQ0o7eUJBQ0ksSUFBSSxPQUFPLENBQUMsSUFBSSxRQUFRLEVBQUU7d0JBQzNCLEdBQUcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFBO3FCQUN2Qjt5QkFDSSxJQUFJLENBQUMsWUFBWSxLQUFLLEVBQUU7d0JBQ3pCLEdBQUcsQ0FBQyxZQUFZLEdBQUc7NEJBQ2YsSUFBSSxFQUFFLENBQUMsQ0FBQzs0QkFDUixNQUFNLEVBQUUsQ0FBQyxDQUFDLE9BQU87NEJBQ2pCLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDO3lCQUM5QixDQUFBO3FCQUNKO3lCQUNJO3dCQUNELEdBQUcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO3FCQUN4QjtvQkFDRCxPQUFPLEtBQUssQ0FBQTtpQkFDZjthQUNKO1lBQ0QsT0FBTyxJQUFJLENBQUE7UUFDZixDQUFDO0tBQUE7SUFDRDs7Ozs7O01BTUU7SUFDSSxLQUFLLENBQUMsR0FBYyxFQUFFLEdBQWE7O1lBQ3JDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDNUMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakMsSUFBSTtvQkFDQSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUM5QyxNQUFNLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztpQkFDM0Q7Z0JBQ0QsT0FBTyxDQUFDLEVBQUU7b0JBQ04sU0FBUztvQkFDVCxJQUFJLENBQUMsQ0FBQyxFQUFFO3dCQUNKLEdBQUcsQ0FBQyxZQUFZLEdBQUc7NEJBQ2YsSUFBSSxFQUFFLENBQUMsQ0FBQzs0QkFDUixNQUFNLEVBQUUsc0JBQXNCO3lCQUNqQyxDQUFBO3FCQUNKO3lCQUNJLElBQUksT0FBTyxDQUFDLElBQUksUUFBUSxFQUFFO3dCQUMzQixHQUFHLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQTtxQkFDdkI7eUJBQ0ksSUFBSSxDQUFDLFlBQVksS0FBSyxFQUFFO3dCQUN6QixHQUFHLENBQUMsWUFBWSxHQUFHOzRCQUNmLElBQUksRUFBRSxDQUFDLENBQUM7NEJBQ1IsTUFBTSxFQUFFLENBQUMsQ0FBQyxPQUFPOzRCQUNqQixRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQzt5QkFDOUIsQ0FBQTtxQkFDSjt5QkFDSTt3QkFDRCxHQUFHLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztxQkFDeEI7b0JBQ0QsT0FBTyxLQUFLLENBQUE7aUJBQ2Y7YUFDSjtZQUNELE9BQU8sSUFBSSxDQUFBO1FBQ2YsQ0FBQztLQUFBO0NBQ0o7QUFFRCxNQUFNLFNBQVM7SUFLWCxZQUFZLElBQWdDO1FBSnBDLGFBQVEsR0FBZ0MsRUFBRSxDQUFDO1FBSy9DLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxXQUFXLENBQUMsU0FBaUI7UUFDekIsMkdBQTJHO1FBQzNHLGlHQUFpRztRQUNqRyxvR0FBb0c7UUFFcEcsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQzNCLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQztZQUNmLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDN0IsbUJBQW1CO1lBQ25CLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDO2dCQUFFLFNBQVE7WUFDekMsY0FBYztZQUNkLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDNUIsQ0FBQyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1lBQ3JELElBQUksSUFBSSxDQUFDLFNBQVM7Z0JBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7WUFDdkQsSUFBSSxJQUFJLENBQUMsVUFBVTtnQkFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUMxRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7U0FDNUI7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQztJQUM5QixDQUFDO0lBRUQsU0FBUyxDQUFDLE9BQWU7UUFDckIsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztZQUFFLElBQUksQ0FBQztRQUNqQyxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRU8sWUFBWSxDQUFDLE9BQWU7UUFDaEMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQ3JDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUE7U0FDaEQ7UUFFRCxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDdkMsSUFBSSxPQUFPLElBQUksU0FBUyxJQUFJLE9BQU8sSUFBSSxJQUFJLElBQUksT0FBTyxJQUFJLEVBQUU7WUFBRSxPQUFPLEdBQUcsR0FBRyxDQUFDO1FBQzVFLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUc7WUFBRSxPQUFPLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQTtRQUM5Qyx5REFBeUQ7UUFFekQsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQztJQUVELFNBQVMsQ0FBQyxPQUFlO1FBQ3JCLE9BQU8sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBRXBDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztZQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQTtRQUN0RSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDakMsQ0FBQztJQUVPLFlBQVksQ0FBQyxNQUFXO1FBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUTtZQUFFLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQTtRQUNwRCxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVM7WUFBRSxNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1FBQy9ELElBQUksTUFBTSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRTtZQUMxQywwQkFBMEI7WUFDMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQTtTQUNqQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUE2QjtRQUMvQixPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUU7WUFDZCxJQUFJLE9BQU8sSUFBSSxTQUFTO2dCQUFFLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFBO1lBQy9DLElBQUksT0FBTyxPQUFPLElBQUksUUFBUSxFQUFFO2dCQUM1QixJQUFJLEVBQUUsR0FBRyxZQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLElBQUksT0FBTyxFQUFFO29CQUNwQixPQUFPLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQztpQkFDcEI7cUJBQ0k7b0JBQ0QsT0FBTyxHQUFHLFdBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtpQkFDbEM7YUFDSjtZQUVELE9BQU8sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXJDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUTtnQkFBRSxPQUFPO1lBQzNCLHdCQUF3QjtZQUN4QixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ3hCLFNBQVM7Z0JBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFBO2dCQUN4RyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUztvQkFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFBO2dCQUM5RixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVTtvQkFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFBO2dCQUNqRyxJQUFJLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQzthQUM3QjtpQkFDSTtnQkFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQ3ZDLElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFBO2FBQzVCO1FBQ0wsQ0FBQyxDQUFBO0lBQ0wsQ0FBQztJQUVELGFBQWEsQ0FBQyxVQUEwQztRQUNwRCxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU07WUFBRSxVQUFVLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7O01BRUU7SUFDRixLQUFLLENBQUMsSUFBYTtRQUNmLE9BQU8sQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFFO1lBQ2hDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDekIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUM5QixJQUFJLElBQUksSUFBSSxTQUFTLElBQUksT0FBTyxJQUFJLElBQUksUUFBUTtnQkFBRSxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQzlELElBQUksSUFBSSxJQUFJLFNBQVMsSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLFNBQVM7Z0JBQUUsT0FBTztZQUMvRCxJQUFJLElBQUksQ0FBQyxRQUFRO2dCQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHO29CQUM5QyxNQUFNLEVBQUUsTUFBTTtvQkFDZCxLQUFLLEVBQUUsVUFBVSxDQUFDLEtBQVk7b0JBQzlCLE1BQU0sRUFBRyxVQUFrQixDQUFDLE1BQU07aUJBQ3JDLENBQUE7UUFDTCxDQUFDLENBQUE7SUFDTCxDQUFDO0lBRUQ7O01BRUU7SUFDRixNQUFNLENBQUMsS0FBYSxFQUFFLEtBQXdCLEVBQUUsUUFBaUIsRUFBRSxNQUFlO1FBQzlFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQTBDLEVBQUUsRUFBRTtZQUNoRSxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBQzlCLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFO2dCQUN0QyxhQUFhO2dCQUNiLE9BQU87YUFDVjtZQUNELElBQUksT0FBTyxJQUFJLElBQUksUUFBUSxFQUFFO2dCQUN6QixVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQTthQUNqRjtpQkFDSTtnQkFDRCwyQkFBMkI7Z0JBQzNCLE9BQU8sQ0FBQyxJQUFJLENBQUMsOEJBQThCLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxLQUFLLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQTthQUNsRjtRQUNMLENBQUMsQ0FBQTtJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU07UUFDRixPQUFPLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxVQUEwQyxFQUFFLEVBQUU7WUFDaEUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUM5QixJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBQ3pCLElBQUksVUFBVSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUTtnQkFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7b0JBQ2pFLE1BQU0sRUFBRSxNQUFNO29CQUNkLE1BQU0sRUFBRSxVQUFVLENBQUMsTUFBTSxJQUFJLEVBQUU7b0JBQy9CLEtBQUssRUFBRSxVQUFVLENBQUMsS0FBSztpQkFDMUIsQ0FBQyxDQUFBO1FBQ04sQ0FBQyxDQUFBO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSztRQUNELE9BQU8sQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQTBDLEVBQUUsRUFBRTtZQUNoRSxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBQzlCLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDekIsSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxRQUFRO2dCQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztvQkFDaEUsTUFBTSxFQUFFLE1BQU07b0JBQ2QsTUFBTSxFQUFFLFVBQVUsQ0FBQyxNQUFNLElBQUksRUFBRTtvQkFDL0IsS0FBSyxFQUFFLFVBQVUsQ0FBQyxLQUFLO2lCQUMxQixDQUFDLENBQUE7UUFDTixDQUFDLENBQUE7SUFDTCxDQUFDO0NBQ0o7QUFFRCxNQUFhLFNBQVM7SUFBdEI7UUFDSSxhQUFRLEdBQUcsRUFBRSxDQUFBO1FBU0wsY0FBUyxHQUFHLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ25DLFdBQU0sR0FBRyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUM3QixhQUFRLEdBQUcsSUFBSSxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUE7UUF5RHpDLFFBQVE7UUFDQSxTQUFJLEdBQTRCLEVBQUUsQ0FBQTtJQThEOUMsQ0FBQztJQWxJRyxJQUFJLENBQUMsUUFBZ0IsRUFBRSxHQUE2QjtRQUNoRCxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQzVDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBRXRCLFlBQVk7UUFDWixJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDNUMsQ0FBQztJQU1EOztNQUVFO0lBQ0YsS0FBSyxDQUFDLE9BQTZCO1FBQy9CLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLElBQWE7UUFDZixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxJQUFZLEVBQUUsSUFBdUIsRUFBRSxRQUFpQixFQUFFLE1BQWU7UUFDNUUsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNO1FBQ0YsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUs7UUFDRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVMsQ0FBQyxPQUE0QjtRQUNsQyxJQUFJLE9BQU8sT0FBTyxJQUFJLFFBQVEsRUFBRTtZQUM1QixPQUFPLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQztTQUM5QjtRQUVELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDM0MsQ0FBQztJQUVELFlBQVk7UUFDUixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO0lBQy9DLENBQUM7SUFFRCxlQUFlO1FBQ1gsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUN2QyxDQUFDO0lBSUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLEdBQTRCO1FBQy9CLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFBO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU07UUFDRixJQUFJLE9BQU8sSUFBSSxDQUFDLElBQUksSUFBSSxVQUFVLEVBQUU7WUFDaEMsT0FBTyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7U0FDckI7YUFDSTtZQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztTQUNwQjtJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNILFFBQVEsQ0FBQyxPQUE2QjtRQUNsQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsUUFBUTtRQUNKLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxXQUFXO1FBQ1AsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZO1FBQ1IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILFdBQVc7UUFDUCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDbEMsQ0FBQztDQUNKO0FBcElELDhCQW9JQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRGdW5jdGlvbiwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tIFwiZXhwcmVzc1wiO1xyXG5pbXBvcnQgeyBJbmNvbWluZ0h0dHBIZWFkZXJzIH0gZnJvbSBcImh0dHBcIjtcclxuaW1wb3J0IHsgam9pbiwgcGFyc2UsIHNlcCB9IGZyb20gXCJwYXRoXCI7XHJcblxyXG5cclxuZnVuY3Rpb24gcGFyc2VFcnJvckxpbmUoZXJyOiBFcnJvcikge1xyXG4gICAgaWYgKCFlcnIgfHwgIShlcnIgaW5zdGFuY2VvZiBFcnJvcikgfHwgIWVyci5zdGFjaykge1xyXG4gICAgICAgIHJldHVybiAnWy1dJ1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YWNrID0gZXJyLnN0YWNrO1xyXG4gICAgY29uc3Qgc3RhY2tBcnIgPSBzdGFjay5zcGxpdCgnXFxuJyk7XHJcbiAgICBsZXQgY2FsbGVyTG9nSW5kZXggPSAoc3RhY2tBcnIubGVuZ3RoID4gMCkgPyAxIDogMDtcclxuICAgIC8vIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhY2tBcnIubGVuZ3RoOyBpKyspIHtcclxuICAgIC8vICAgICBpZiAoc3RhY2tBcnJbaV0uaW5kZXhPZignbWFrZUVycm9yJykgPiAwICYmIGkgKyAxIDwgc3RhY2tBcnIubGVuZ3RoKSB7XHJcbiAgICAvLyAgICAgICAgIGNhbGxlckxvZ0luZGV4ID0gaSArIDE7XHJcbiAgICAvLyAgICAgICAgIGJyZWFrO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICBpZiAoY2FsbGVyTG9nSW5kZXggIT09IDApIHtcclxuICAgICAgICBjb25zdCBjYWxsZXJTdGFja0xpbmUgPSBzdGFja0FycltjYWxsZXJMb2dJbmRleF0gYXMgc3RyaW5nO1xyXG4gICAgICAgIGxldCBsaXN0ID0gY2FsbGVyU3RhY2tMaW5lLnNwbGl0KC9cXCh8XFwpLylcclxuICAgICAgICBpZiAobGlzdFsxXSAmJiBsaXN0WzFdLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGBbJHtsaXN0WzFdLnJlcGxhY2UocHJvY2Vzcy5jd2QoKSwgJycpLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpLnJlcGxhY2UoJy8nLCAnJyl9XWBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgWyR7Y2FsbGVyU3RhY2tMaW5lLnN1YnN0cmluZyhjYWxsZXJTdGFja0xpbmUubGFzdEluZGV4T2Yoc2VwKSArIDEsIGNhbGxlclN0YWNrTGluZS5sYXN0SW5kZXhPZignOicpKX1dYDtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnWy1dJztcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSZXF1ZXN0RXggZXh0ZW5kcyBSZXF1ZXN0IHtcclxuICAgIHJlc3BvbnNlRGF0YTogYW55XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFNlUGFyYW1Db25maWdUeXBlID0gXCJiaWdpbnRcIiB8IFwiYm9vbGVhblwiIHwgXCJmdW5jdGlvblwiIHwgXCJudW1iZXJcIiB8IFwib2JqZWN0XCIgfCBcInN0cmluZ1wiIHwgXCJzeW1ib2xcIlxyXG5cclxuaW50ZXJmYWNlIGlmUGFyYW1DaGVja0NvbmZpZyB7IFtuYW1lOiBzdHJpbmddOiB7IHR5cGU6IFNlUGFyYW1Db25maWdUeXBlLCByZXF1aXJlZDogYm9vbGVhbiwgY2hhbmdlOiBib29sZWFuIH0gfVxyXG5pbnRlcmZhY2UgVHlwZWRQcm9wZXJ0eURlc2NyaXB0b3JFeDxUPiBleHRlbmRzIFR5cGVkUHJvcGVydHlEZXNjcmlwdG9yPFQ+IHtcclxuICAgIHBhcmFtcz86IGlmUGFyYW1DaGVja0NvbmZpZ1xyXG59XHJcblxyXG5cclxuY2xhc3MgSGFuZGxlVW5pdCB7XHJcbiAgICBzeW1ib2w6IHN5bWJvbFxyXG4gICAgY29uc3RydWN0b3Ioc3ltYm9sPzogc3ltYm9sKSB7XHJcbiAgICAgICAgdGhpcy5zeW1ib2wgPSBzeW1ib2wgfHwgU3ltYm9sKClcclxuICAgIH1cclxuXHJcbiAgICByb3V0ZU1hcDoge1xyXG4gICAgICAgIFtmOiBzdHJpbmddOiB7XHJcbiAgICAgICAgICAgIHRhcmdldDogYW55O1xyXG4gICAgICAgICAgICB2YWx1ZTogKHBhcmFtOiB7IFt4OiBzdHJpbmddOiBhbnkgfSwgbWV0aG9kOiBzdHJpbmcsIGhlYWRlcnM6IEluY29taW5nSHR0cEhlYWRlcnMsIHJlcT86IFJlcXVlc3RFeCkgPT4gUHJvbWlzZTxhbnk+O1xyXG4gICAgICAgICAgICBwYXJhbXM6IGlmUGFyYW1DaGVja0NvbmZpZ1xyXG4gICAgICAgIH1cclxuICAgIH0gPSB7fTtcclxuICAgIGJlZm9yZUxpc3Q6IHtcclxuICAgICAgICB0YXJnZXQ6IGFueTtcclxuICAgICAgICBwYXJhbXM6IGlmUGFyYW1DaGVja0NvbmZpZyxcclxuICAgICAgICB2YWx1ZTogKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4gYW55XHJcbiAgICB9W10gPSBbXVxyXG4gICAgYWZ0ZXJMaXN0OiB7XHJcbiAgICAgICAgdGFyZ2V0OiBhbnk7XHJcbiAgICAgICAgdmFsdWU6IChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IGFueVxyXG4gICAgICAgIHBhcmFtczogaWZQYXJhbUNoZWNrQ29uZmlnLFxyXG4gICAgfVtdID0gW11cclxuXHJcblxyXG4gICAgcGFyYW1zQ2hlY2soY2hlY2tNYXA6IGlmUGFyYW1DaGVja0NvbmZpZywgcGFyYW1zOiB7IFt4OiBzdHJpbmddOiBhbnkgfSkge1xyXG4gICAgICAgIGlmIChjaGVja01hcCA9PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIGNoZWNrTWFwKSB7XHJcbiAgICAgICAgICAgIGxldCBjZmcgPSBjaGVja01hcFtrZXldO1xyXG4gICAgICAgICAgICBpZiAoY2ZnLnJlcXVpcmVkICYmICFwYXJhbXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgLy8g6L+Z6YeM5rKh5om+5YiwIOaKm+WHuuS4gOS4quW8guW4uFxyXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYHBhcmFtIFske2tleX0gcmVxdWlyZWQgYW5kIHR5cGUgbGltaXQgJHtjZmcudHlwZX1dYClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICghcGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoY2ZnLnR5cGUgPT0gdHlwZW9mIHBhcmFtc1trZXldKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDov5nph4znsbvlnovkuI3lkIxcclxuICAgICAgICAgICAgaWYgKCFjZmcuY2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgcGFyYW0gWyR7a2V5fSB0eXBlIGxpbWl0ICR7Y2ZnLnR5cGV9XWApXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNmZy50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJpZ2ludFwiOiBwYXJhbXNba2V5XSA9IEJpZ0ludChwYXJhbXNba2V5XSk7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJib29sZWFuXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtc1trZXldID09IHRydWUgfHwgcGFyYW1zW2tleV0gPT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1trZXldID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1trZXldID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyYW1zW2tleV0gPSBCb29sZWFuKHBhcmFtc1trZXldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOiB0aHJvdyBFcnJvcihgcGFyYW0gWyR7a2V5fSB0eXBlIGxpbWl0ICR7Y2ZnLnR5cGV9XWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjogcGFyYW1zW2tleV0gPSBOdW1iZXIocGFyYW1zW2tleV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDov5nph4zlop7liqDkuIDkuKrlsI/kvJjljJYg77yM5aaC5p6c5piv5pW05pWw6YKj5LmI55u05o6l6L2s5o2i5oiQ5pW05pWwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXNba2V5XSA9IHBhcnNlSW50KHBhcmFtc1trZXldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zW2tleV0gPSBwYXJzZUludChwYXJhbXNba2V5XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwib2JqZWN0XCI6IHBhcmFtc1trZXldID0gSlNPTi5wYXJzZShwYXJhbXNba2V5XS50b1N0cmluZygpKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInN0cmluZ1wiOiBwYXJhbXNba2V5XSA9IFN0cmluZyhwYXJhbXNba2V5XSk7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzeW1ib2xcIjogcGFyYW1zW2tleV0gPSBTeW1ib2wocGFyYW1zW2tleV0pOyBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDosIPnlKjmjqXlj6NcclxuICAgIGdldFJvdXRlRnVuYyhOYW1lOiBzdHJpbmcsIHJlcTogUmVxdWVzdEV4KSB7XHJcbiAgICAgICAgbGV0IHJvdXRlT2JqID0gdGhpcy5yb3V0ZU1hcFtOYW1lXTtcclxuICAgICAgICBpZiAoIXJvdXRlT2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucGFyYW1zQ2hlY2socm91dGVPYmoucGFyYW1zLCByZXEucGFyYW1zKVxyXG4gICAgICAgIHJldHVybiByb3V0ZU9iai52YWx1ZS5iaW5kKHJvdXRlT2JqLnRhcmdldCwgcmVxLnBhcmFtcywgcmVxLm1ldGhvZC50b1VwcGVyQ2FzZSgpLCByZXEuaGVhZGVycywgcmVxKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6LCD55So5qih5Z2XXHJcbiAgICAgKiBAcGFyYW0gcGF0aGxpc3QgXHJcbiAgICAgKiBAcGFyYW0gcmVxIFxyXG4gICAgICogQHBhcmFtIHJlcyBcclxuICAgICAqIEBwYXJhbSBuZXh0IFxyXG4gICAgICovXHJcbiAgICBhc3luYyByb3V0ZShOYW1lOiBzdHJpbmcsIHJlcTogUmVxdWVzdEV4LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBsZXQgcm91dGVGdW5jID0gdGhpcy5nZXRSb3V0ZUZ1bmMoTmFtZSwgcmVxKVxyXG4gICAgICAgICAgICBpZiAoIXJvdXRlRnVuYykge1xyXG4gICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSxcclxuICAgICAgICAgICAgICAgICAgICBlcnJNc2c6IFwiY2FuIG5vdCBmaW5kIFtcIiArIHJlcS5wYXRoICsgXCJdXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDov5nph4zlvIDlp4vosIPnlKjlk43lupRcclxuICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGF3YWl0IHJvdXRlRnVuYygpXHJcbiAgICAgICAgICAgIGlmIChyZXEucmVzcG9uc2VEYXRhID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IHsgY29kZTogMCB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlKSB7XHJcbiAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgIGVyck1zZzogXCJlcnJvciBidWcgbm8gbWVzc2FnZVwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGUgPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSBlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgIGVyck1zZzogZS5tZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIF9fbGluZV9fOiBwYXJzZUVycm9yTGluZShlKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICog6LCD55So5qih5Z2XXHJcbiAgICAqIEBwYXJhbSBwYXRobGlzdCBcclxuICAgICogQHBhcmFtIHJlcSBcclxuICAgICogQHBhcmFtIHJlcyBcclxuICAgICogQHBhcmFtIG5leHQgXHJcbiAgICAqL1xyXG4gICAgYXN5bmMgYmVmb3JlKHJlcTogUmVxdWVzdEV4LCByZXM6IFJlc3BvbnNlKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJlZm9yZUxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IHJvdXRlTWFwID0gdGhpcy5iZWZvcmVMaXN0W2ldO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJhbXNDaGVjayhyb3V0ZU1hcC5wYXJhbXMsIHJlcS5wYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgcm91dGVNYXAudmFsdWUuYXBwbHkocm91dGVNYXAudGFyZ2V0LCBbcmVxLCByZXNdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5Ye66ZKx5byC5bi455qE5YyWXHJcbiAgICAgICAgICAgICAgICBpZiAoIWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyTXNnOiBcImVycm9yIGJ1ZyBubyBtZXNzYWdlXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSBlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyTXNnOiBlLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fbGluZV9fOiBwYXJzZUVycm9yTGluZShlKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgKiDosIPnlKjmqKHlnZdcclxuICAgICogQHBhcmFtIHBhdGhsaXN0IFxyXG4gICAgKiBAcGFyYW0gcmVxIFxyXG4gICAgKiBAcGFyYW0gcmVzIFxyXG4gICAgKiBAcGFyYW0gbmV4dCBcclxuICAgICovXHJcbiAgICBhc3luYyBhZnRlcihyZXE6IFJlcXVlc3RFeCwgcmVzOiBSZXNwb25zZSkge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hZnRlckxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IHJvdXRlTWFwID0gdGhpcy5hZnRlckxpc3RbaV07XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmFtc0NoZWNrKHJvdXRlTWFwLnBhcmFtcywgcmVxLnBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCByb3V0ZU1hcC52YWx1ZS5hcHBseShyb3V0ZU1hcC50YXJnZXQsIFtyZXEsIHJlc10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlh7rpkrHlvILluLjnmoTljJZcclxuICAgICAgICAgICAgICAgIGlmICghZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJNc2c6IFwiZXJyb3IgYnVnIG5vIG1lc3NhZ2VcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBlID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJNc2c6IGUubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgX19saW5lX186IHBhcnNlRXJyb3JMaW5lKGUpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBIYW5kbGVNYXAge1xyXG4gICAgcHJpdmF0ZSByb3V0ZU1hcDogeyBbZjogc3RyaW5nXTogSGFuZGxlVW5pdCB9ID0ge307XHJcbiAgICBwcml2YXRlIGN1cnJOb2RlOiBIYW5kbGVVbml0IHwgdW5kZWZpbmVkO1xyXG4gICAgcHJpdmF0ZSB0eXBlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIG1haW5QYXRoOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBcInJvdXRlXCIgfCBcImVudlwiIHwgXCJnbG9iYWxcIikge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgbWVyZ2VNb2R1bGUoZmlsZVJvdXRlOiBzdHJpbmcpIHtcclxuICAgICAgICAvLyB0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLnJvdXRlTWFwID0gT2JqZWN0LmFzc2lnbih0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLnJvdXRlTWFwLCB0aGlzLmN1cnJOb2RlLnJvdXRlTWFwKVxyXG4gICAgICAgIC8vIGlmICh0aGlzLmN1cnJOb2RlLmFmdGVyTGlzdCkgdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXS5hZnRlckxpc3QucHVzaCguLi50aGlzLmN1cnJOb2RlLmFmdGVyTGlzdClcclxuICAgICAgICAvLyBpZiAodGhpcy5jdXJyTm9kZS5iZWZvcmVMaXN0KSB0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLmJlZm9yZUxpc3QucHVzaCguLi50aGlzLmN1cnJOb2RlLmJlZm9yZUxpc3QpXHJcblxyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLnJvdXRlTWFwKSB7XHJcbiAgICAgICAgICAgIGxldCBmaWxlID0ga2V5O1xyXG4gICAgICAgICAgICBsZXQgbW1hcCA9IHRoaXMucm91dGVNYXBba2V5XVxyXG4gICAgICAgICAgICAvLyDliKTmlq3kuIDkuIvmmK/lhajot6/lvoTnmoTov5jmmK/nm7jlr7nlnLDlnYDnmoRcclxuICAgICAgICAgICAgaWYgKGZpbGUuaW5kZXhPZihmaWxlUm91dGUpIDwgMCkgY29udGludWVcclxuICAgICAgICAgICAgLy8g6L+Z6YeM5pS55oiQ55u45a+55Zyw5Z2A55qE5qih5Z2XXHJcbiAgICAgICAgICAgIGxldCBuS2V5ID0ga2V5LnJlcGxhY2UoZmlsZVJvdXRlLCBcIi9cIik7XHJcbiAgICAgICAgICAgIGxldCBuID0gdGhpcy5nZXRNb2R1bGUobktleSlcclxuICAgICAgICAgICAgbi5yb3V0ZU1hcCA9IE9iamVjdC5hc3NpZ24obW1hcC5yb3V0ZU1hcCwgbi5yb3V0ZU1hcClcclxuICAgICAgICAgICAgaWYgKG1tYXAuYWZ0ZXJMaXN0KSBuLmFmdGVyTGlzdC5wdXNoKC4uLm1tYXAuYWZ0ZXJMaXN0KVxyXG4gICAgICAgICAgICBpZiAobW1hcC5iZWZvcmVMaXN0KSBuLmJlZm9yZUxpc3QucHVzaCguLi5tbWFwLmJlZm9yZUxpc3QpXHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnJvdXRlTWFwW2tleV1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tYWluUGF0aCA9IGZpbGVSb3V0ZTtcclxuICAgIH1cclxuXHJcbiAgICBoYXNNb2R1bGUocHJlUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucm91dGVNYXBbcHJlUGF0aF0pIHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZm9ybWF0ZVJvdXRlKHByZVBhdGg6IHN0cmluZykge1xyXG4gICAgICAgIHByZVBhdGggPSBwcmVQYXRoLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpXHJcbiAgICAgICAgaWYgKHRoaXMubWFpblBhdGgpIHtcclxuICAgICAgICAgICAgcHJlUGF0aCA9IHByZVBhdGgucmVwbGFjZSh0aGlzLm1haW5QYXRoLCBcIi9cIilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByZVBhdGggPSBwcmVQYXRoLnJlcGxhY2UoL1xcL1xcLy9nLCBcIi9cIilcclxuICAgICAgICBpZiAocHJlUGF0aCA9PSB1bmRlZmluZWQgfHwgcHJlUGF0aCA9PSBudWxsIHx8IHByZVBhdGggPT0gXCJcIikgcHJlUGF0aCA9IFwiL1wiO1xyXG4gICAgICAgIGlmIChwcmVQYXRoWzBdICE9IFwiL1wiKSBwcmVQYXRoID0gXCIvXCIgKyBwcmVQYXRoXHJcbiAgICAgICAgLy8gaWYgKHByZVBhdGguY2hhckF0KDApICE9IFwiL1wiKSBwcmVQYXRoID0gXCIvXCIgKyBwcmVQYXRoO1xyXG5cclxuICAgICAgICByZXR1cm4gcHJlUGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRNb2R1bGUocHJlUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgcHJlUGF0aCA9IHRoaXMuZm9ybWF0ZVJvdXRlKHByZVBhdGgpXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXSkgdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXSA9IG5ldyBIYW5kbGVVbml0KClcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NoZWNoTWV0aG9kKHRhcmdldDogYW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJOb2RlKSB0aGlzLmN1cnJOb2RlID0gbmV3IEhhbmRsZVVuaXQoKVxyXG4gICAgICAgIGlmICghdGFyZ2V0Ll9fX3N5bWJvbCkgdGFyZ2V0Ll9fX3N5bWJvbCA9IHRoaXMuY3Vyck5vZGUuc3ltYm9sO1xyXG4gICAgICAgIGlmICh0YXJnZXQuX19fc3ltYm9sICE9IHRoaXMuY3Vyck5vZGUuc3ltYm9sKSB7XHJcbiAgICAgICAgICAgIC8vIOihqOekuuazqOWGjOeahOS4jeaYr+W9k+WJjWNsYXNz55qE5qih5Z2X5LqG77yM6ZyA6KaB5pu/5o2iXHJcbiAgICAgICAgICAgIHRoaXMuY3Vyck5vZGUgPSBuZXcgSGFuZGxlVW5pdFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruaooeWdl+eahOW9kuWxnlxyXG4gICAgICovXHJcbiAgICBjbGFzcyhwcmVQYXRoPzogc3RyaW5nIHwgTm9kZU1vZHVsZSk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gKHRhcmdldCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocHJlUGF0aCA9PSB1bmRlZmluZWQpIHByZVBhdGggPSB0YXJnZXQubmFtZVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHByZVBhdGggIT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBkID0gcGFyc2UocHJlUGF0aC5maWxlbmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGQubmFtZSA9PSBcImluZGV4XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcmVQYXRoID0gcGQuZGlyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJlUGF0aCA9IGpvaW4ocGQuZGlyLCBwZC5uYW1lKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwcmVQYXRoID0gdGhpcy5mb3JtYXRlUm91dGUocHJlUGF0aCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY3Vyck5vZGUpIHJldHVybjtcclxuICAgICAgICAgICAgLy8g6L+Z6YeM6LSf6LSj5oqK5b2T5YmN5rOo5YaM55qE6IqC54K55re75Yqg5Yiw55uu5qCH6IqC54K55bqT5LitXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvdXRlTWFwW3ByZVBhdGhdKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDov5nph4zpnIDopoHlkIjlubZcclxuICAgICAgICAgICAgICAgIHRoaXMucm91dGVNYXBbcHJlUGF0aF0ucm91dGVNYXAgPSBPYmplY3QuYXNzaWduKHRoaXMucm91dGVNYXBbcHJlUGF0aF0ucm91dGVNYXAsIHRoaXMuY3Vyck5vZGUucm91dGVNYXApXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyTm9kZS5hZnRlckxpc3QpIHRoaXMucm91dGVNYXBbcHJlUGF0aF0uYWZ0ZXJMaXN0LnB1c2goLi4udGhpcy5jdXJyTm9kZS5hZnRlckxpc3QpXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyTm9kZS5iZWZvcmVMaXN0KSB0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLmJlZm9yZUxpc3QucHVzaCguLi50aGlzLmN1cnJOb2RlLmJlZm9yZUxpc3QpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJOb2RlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXSA9IHRoaXMuY3Vyck5vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJOb2RlID0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbWV0aG9kUHJlcGFyZShkZXNjcmlwdG9yOiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvckV4PGFueT4pIHtcclxuICAgICAgICBpZiAoIWRlc2NyaXB0b3IucGFyYW1zKSBkZXNjcmlwdG9yLnBhcmFtcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDms6jlhozot6/nlLFcclxuICAgICovXHJcbiAgICByb3V0ZShOYW1lPzogc3RyaW5nKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gKHRhcmdldCwgbmFtZSwgZGVzY3JpcHRvcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9jaGVjaE1ldGhvZCh0YXJnZXQpXHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kUHJlcGFyZShkZXNjcmlwdG9yKVxyXG4gICAgICAgICAgICBpZiAoTmFtZSA9PSB1bmRlZmluZWQgJiYgdHlwZW9mIG5hbWUgPT0gXCJzdHJpbmdcIikgTmFtZSA9IG5hbWU7XHJcbiAgICAgICAgICAgIGlmIChOYW1lID09IHVuZGVmaW5lZCB8fCBkZXNjcmlwdG9yLnZhbHVlID09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyTm9kZSkgdGhpcy5jdXJyTm9kZS5yb3V0ZU1hcFtOYW1lXSA9IHtcclxuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRlc2NyaXB0b3IudmFsdWUgYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiAoZGVzY3JpcHRvciBhcyBhbnkpLnBhcmFtc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDmo4Dmn6Xot6/nlLHlj4LmlbAg5aaC5p6c6LCD55So5LqG6YKj5LmI5bCx57uZ6L+Z5Liq5Ye95pWw5aKe5Yqg5LiA5Liq5Y+C5pWw5qOA5p+l55qE5qCH6K+G77yM5ZCm5YiZ5bCx5LiN5aSE55CGXHJcbiAgICAqL1xyXG4gICAgcGFyYW1zKHBOYW1lOiBzdHJpbmcsIHBUeXBlOiBTZVBhcmFtQ29uZmlnVHlwZSwgcmVxdWlyZWQ6IGJvb2xlYW4sIGNoYW5nZTogYm9vbGVhbik6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuICh0YXJnZXQsIG5hbWUsIGRlc2NyaXB0b3I6IFR5cGVkUHJvcGVydHlEZXNjcmlwdG9yRXg8YW55PikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZFByZXBhcmUoZGVzY3JpcHRvcilcclxuICAgICAgICAgICAgdGhpcy5fY2hlY2hNZXRob2QodGFyZ2V0KVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY3Vyck5vZGUgfHwgIWRlc2NyaXB0b3IucGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDnkIborrrkuIrkuI3kvJrov5vlhaXov5nph4znmoRcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRvci5wYXJhbXNbcE5hbWVdID0geyB0eXBlOiBwVHlwZSwgcmVxdWlyZWQ6IHJlcXVpcmVkLCBjaGFuZ2U6IGNoYW5nZSB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDov5nph4zlpoLmnpzkvKDlhaXnmoTmmK8gc3ltYm9sIOmCo+S5iOWwseavlOi+g+mavuWPl+S6hlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBwYXJhbXMgY2hlY2sgZXJyb3Igb24gZnVuYyAke25hbWUudG9TdHJpbmcoKX0gJHtwTmFtZX0gJHtwVHlwZX1gKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5Z2X5pa55rOV6LCD55So5YmN55qE6LCD55So77yM5Li76KaB5piv57uZ5pWw5o2u5aSE55CG5o+Q5L6b5YmN572u5YeG5aSHXHJcbiAgICAgKi9cclxuICAgIGJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiAodGFyZ2V0LCBuYW1lLCBkZXNjcmlwdG9yOiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvckV4PGFueT4pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5tZXRob2RQcmVwYXJlKGRlc2NyaXB0b3IpXHJcbiAgICAgICAgICAgIHRoaXMuX2NoZWNoTWV0aG9kKHRhcmdldClcclxuICAgICAgICAgICAgaWYgKGRlc2NyaXB0b3IudmFsdWUgJiYgdGhpcy5jdXJyTm9kZSkgdGhpcy5jdXJyTm9kZS5iZWZvcmVMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IGRlc2NyaXB0b3IucGFyYW1zIHx8IHt9LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRlc2NyaXB0b3IudmFsdWVcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgYWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gKHRhcmdldCwgbmFtZSwgZGVzY3JpcHRvcjogVHlwZWRQcm9wZXJ0eURlc2NyaXB0b3JFeDxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kUHJlcGFyZShkZXNjcmlwdG9yKVxyXG4gICAgICAgICAgICB0aGlzLl9jaGVjaE1ldGhvZCh0YXJnZXQpXHJcbiAgICAgICAgICAgIGlmIChkZXNjcmlwdG9yLnZhbHVlICYmIHRoaXMuY3Vyck5vZGUpIHRoaXMuY3Vyck5vZGUuYWZ0ZXJMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IGRlc2NyaXB0b3IucGFyYW1zIHx8IHt9LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRlc2NyaXB0b3IudmFsdWVcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXZWJIYW5kbGUge1xyXG4gICAgbWFpblBhdGggPSBcIlwiXHJcbiAgICBpbml0KG1haW5QYXRoOiBzdHJpbmcsIGVudj86ICgoKSA9PiBzdHJpbmcpIHwgc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5tYWluUGF0aCA9IG1haW5QYXRoLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpXHJcbiAgICAgICAgdGhpcy5zZXRFbnYoZW52IHx8IFwiXCIpXHJcblxyXG4gICAgICAgIC8vIOWQiOW5tuS4gOS4i+WViuWQhOenjeaooeWdl1xyXG4gICAgICAgIHRoaXMucm91dGVNYXAubWVyZ2VNb2R1bGUodGhpcy5tYWluUGF0aClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdsb2JhbE1hcCA9IG5ldyBIYW5kbGVNYXAoXCJnbG9iYWxcIilcclxuICAgIHByaXZhdGUgZW52TWFwID0gbmV3IEhhbmRsZU1hcChcImVudlwiKVxyXG4gICAgcHJpdmF0ZSByb3V0ZU1hcCA9IG5ldyBIYW5kbGVNYXAoXCJyb3V0ZVwiKVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDorr7nva7mqKHlnZfnmoTlvZLlsZ5cclxuICAgICovXHJcbiAgICBjbGFzcyhwcmVQYXRoPzogc3RyaW5nIHwgTm9kZU1vZHVsZSk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcC5jbGFzcyhwcmVQYXRoKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rOo5YaM6Lev55SxXHJcbiAgICAgKi9cclxuICAgIHJvdXRlKE5hbWU/OiBzdHJpbmcpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJvdXRlTWFwLnJvdXRlKE5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rOo5YaM5Y+C5pWw5qOA5p+lXHJcbiAgICAgKi9cclxuICAgIHBhcmFtcyhOYW1lOiBzdHJpbmcsIHR5cGU6IFNlUGFyYW1Db25maWdUeXBlLCByZXF1aXJlZDogYm9vbGVhbiwgY2hhbmdlOiBib29sZWFuKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcC5wYXJhbXMoTmFtZSwgdHlwZSwgcmVxdWlyZWQsIGNoYW5nZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjliY3nmoTosIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvliY3nva7lh4blpIdcclxuICAgICAqL1xyXG4gICAgYmVmb3JlKCk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucm91dGVNYXAuYmVmb3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgYWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcC5hZnRlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5LiA5Liq5ZON5bqU5qih5Z2XXHJcbiAgICAgKiBAcGFyYW0gcHJlUGF0aCDlj6/ku6Xorr7nva7nm7jlr7not6/lvoTlrZfnrKbkuLLvvIzmiJbogIXmqKHlnZflr7nosaFcclxuICAgICAqL1xyXG4gICAgZ2V0TW9kdWxlKHByZVBhdGg6IHN0cmluZyB8IE5vZGVNb2R1bGUpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHByZVBhdGggIT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBwcmVQYXRoID0gcHJlUGF0aC5maWxlbmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnJvdXRlTWFwLmdldE1vZHVsZShwcmVQYXRoKVxyXG4gICAgfVxyXG5cclxuICAgIGdldEVudk1vZHVsZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbnZNYXAuZ2V0TW9kdWxlKHRoaXMuZ2V0RW52KCkpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0R2xvYmFsTW9kdWxlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdsb2JhbE1hcC5nZXRNb2R1bGUoXCJcIilcclxuICAgIH1cclxuXHJcbiAgICAvLyDlvZPliY3nmoTnjq/looNcclxuICAgIHByaXZhdGUgX2VudjogKCgpID0+IHN0cmluZykgfCBzdHJpbmcgPSBcIlwiXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruW9k+WJjeeOr+WigyDvvIjkuLvopoHmmK/mj5Dkvpvnu5nlpITnkIbmlrnms5XosIPnlKjnjq/looPliKTmlq3vvIlcclxuICAgICAqIEBwYXJhbSBlbnYg546v5aKD5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHNldEVudihlbnY6ICgoKSA9PiBzdHJpbmcpIHwgc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fZW52ID0gZW52XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blvZPliY3njq/looNcclxuICAgICAqL1xyXG4gICAgZ2V0RW52KCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5fZW52ID09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZW52KClcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbnY7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5qih5Z2X55qE5b2S5bGeXHJcbiAgICAgKi9cclxuICAgIGVudkNsYXNzKHByZVBhdGg/OiBzdHJpbmcgfCBOb2RlTW9kdWxlKTogQ2xhc3NEZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudk1hcC5jbGFzcyhwcmVQYXRoKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5Z2X5pa55rOV6LCD55So5YmN55qE6LCD55So77yM5Li76KaB5piv57uZ5pWw5o2u5aSE55CG5o+Q5L6b5YmN572u5YeG5aSHXHJcbiAgICAgKi9cclxuICAgIGVudkJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudk1hcC5iZWZvcmUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaooeWdl+aWueazleiwg+eUqOWQjuiwg+eUqO+8jOS4u+imgeaYr+e7meaVsOaNruWkhOeQhuaPkOS+m+acgOWQjueahOaTjeS9nFxyXG4gICAgICovXHJcbiAgICBlbnZBZnRlcigpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudk1hcC5hZnRlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YWo5bGA5qih5Z2XXHJcbiAgICAgKi9cclxuICAgIGdsb2JhbENsYXNzKCk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxNYXAuY2xhc3MoXCJcIilcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaooeWdl+aWueazleiwg+eUqOWJjeeahOiwg+eUqO+8jOS4u+imgeaYr+e7meaVsOaNruWkhOeQhuaPkOS+m+WJjee9ruWHhuWkh1xyXG4gICAgICovXHJcbiAgICBnbG9iYWxCZWZvcmUoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxNYXAuYmVmb3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgZ2xvYmFsQWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxNYXAuYWZ0ZXIoKTtcclxuICAgIH1cclxufSJdfQ==