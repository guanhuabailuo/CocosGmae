"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebRouteModule = void 0;
var webHandle_1 = require("./webHandle");
Object.defineProperty(exports, "WebHandle", { enumerable: true, get: function () { return webHandle_1.WebHandle; } });
var HttpQuest_1 = require("./HttpQuest");
Object.defineProperty(exports, "http_quest", { enumerable: true, get: function () { return HttpQuest_1.http_quest; } });
const server_1 = require("./server");
const path_1 = require("path");
const commonRoute_1 = require("./commonRoute");
const webHandle_2 = require("./webHandle");
const loadWebFiles_1 = require("./loadWebFiles");
const ip_1 = require("./ip");
var instance = new server_1.WebRouteUnit();
var webHandle = new webHandle_2.WebHandle();
/**
 * 这里负责http的解析，然后传递给对于的处理方法
 * 目前比较简陋，后续需要增加一下处理
 *
 * envBefore -> globalBefore -> before -> route -> after -> globalAfter -> envAfter
 *
 */
exports.WebRouteModule = {
    name: 'WebRouteModule',
    /**
     * 是否开启跨域
     */
    openCross() {
        instance.enable("cross");
    },
    // 获取资源实例
    getApp() {
        return instance.app;
    },
    // 开始静态资源目录
    static(pre, root) {
        return instance.static(pre, root);
    },
    proxy(pre, host, options) {
        return instance.proxy(pre, host, options);
    },
    setproxy(ips) {
        return instance.app.set("trust proxy", ips);
    },
    /**
     * 初始化模块
     * @param port
     */
    init(port, webPath, env, limit) {
        return __awaiter(this, void 0, void 0, function* () {
            // 先初始化模块
            webHandle.init(webPath, env);
            // 这里需要增加一个拉起所有的模块文件的功能
            yield instance.init(port, [commonRoute_1.start.bind(webHandle)], limit);
            loadWebFiles_1.loadModule(webPath);
            return true;
        });
    },
    ////////////////////////////////////////////////////////////////
    /**
    * 注册模块
    * @param prePath 模块的前缀词 例如 /a/b 的前缀就是 /a 或者/a/
    */
    class(prePath) {
        return webHandle.class(prePath);
    },
    /**
    * 注册路由
    * @param Name 后缀词 例如 /a/b 的后缀就是 b 或者/b
    */
    route(Name) {
        return webHandle.route(Name);
    },
    /**
    * 检查参数
    * @param name 参数名字
    * @param sType 参数类型
    * @param [change] 是否强制转换类型
    */
    paramRequired(name, sType, change) {
        return webHandle.params(name, sType, true, change);
    },
    /**
   * 检查参数
   * @param name 参数名字
   * @param sType 参数类型
   * @param [change] 是否强制转换类型
   */
    paramOptional(name, sType, change) {
        return webHandle.params(name, sType, false, change);
    },
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    before() {
        return webHandle.before();
    },
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    after() {
        return webHandle.after();
    },
    /////////////////////////////////////////////////
    /**
     * 注册环境处理模块
     * @param evnName 环境名字
     */
    envClass(evnName) {
        return webHandle.envClass(evnName);
    },
    /**
     * 对应环境下先调用
     */
    envBefore() {
        return webHandle.envBefore();
    },
    /**
     * 对应环境下处理后调用
     */
    envAfter() {
        return webHandle.envAfter();
    },
    /**
     * 注册环境处理模块
     * @param evnName 环境名字
     */
    globalClass() {
        return webHandle.globalClass();
    },
    /**
    *
    */
    globalBefore() {
        return webHandle.globalBefore();
    },
    /**
     *
     */
    globalAfter() {
        return webHandle.globalAfter();
    },
    getHandle() {
        return webHandle;
    },
    //////////////////////////////////////////////////////////////
    /**
     * @description 开启Swagger模块
     * @date 2020-01-16
     * @param {{ basedir: string; routePath: string; description?: string; title?: string; version?: string; host?: string; basePath?: string; produces?: string[]; schemes?: string[]; }} { basedir, jsPath, description = 'This is a sample server', title = 'Swagger', version = '1.0.0', host = 'localhost', basePath = '', produces = [
     *             "application/json"
     *         ], schemes = ['http'] }
     */
    openSwagger({ basedir, host, routePath, basePath = '', ext = ".js", description = 'http api server', title = 'dreamduke', version = '1.0.0', produces = [
        "application/json"
    ], schemes = ['http'] }) {
        let option = {
            swaggerDefinition: {
                info: {
                    description: description,
                    title: title,
                    version: version
                },
                host: host || ip_1.IPFindOne("IPv4"),
                basePath: basePath,
                produces: produces,
                schemes: schemes,
                securityDefinitions: {
                    JWT: {
                        type: 'apiKey',
                        in: 'header',
                        name: 'Authorization',
                        description: "",
                    }
                }
            },
            route: {
                url: '/swagger',
                docs: '/swagger.json',
            },
            basedir: basedir || process.cwd(),
            files: [path_1.join(routePath || './web', '/**/*' + (ext || ".js"))] //Path to the API handle folder
        };
        try {
            const expressSwagger = require('express-swagger-generator')(instance.app);
            expressSwagger(option);
        }
        catch (e) {
            if (e && (e instanceof Error)) {
                console.log('open openSwagger need install node_module : npm install ' + (e.message.match(/\'.*\'/) || []).join(' ').replace(/\'/g, ''));
            }
        }
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFDQSx5Q0FBMkQ7QUFBbEQsc0dBQUEsU0FBUyxPQUFBO0FBRWxCLHlDQUF5QztBQUFoQyx1R0FBQSxVQUFVLE9BQUE7QUFFbkIscUNBQXVEO0FBQ3ZELCtCQUE0QjtBQUM1QiwrQ0FBc0M7QUFDdEMsMkNBQTJEO0FBQzNELGlEQUE0QztBQUM1Qyw2QkFBaUM7QUFFakMsSUFBSSxRQUFRLEdBQWlCLElBQUkscUJBQVksRUFBRSxDQUFDO0FBQ2hELElBQUksU0FBUyxHQUFjLElBQUkscUJBQVMsRUFBRSxDQUFDO0FBZ0IzQzs7Ozs7O0dBTUc7QUFDUSxRQUFBLGNBQWMsR0FBRztJQUN4QixJQUFJLEVBQUUsZ0JBQWdCO0lBQ3RCOztPQUVHO0lBQ0gsU0FBUztRQUNMLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUNELFNBQVM7SUFDVCxNQUFNO1FBQ0YsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDO0lBQ3hCLENBQUM7SUFDRCxXQUFXO0lBQ1gsTUFBTSxDQUFDLEdBQVcsRUFBRSxJQUFZO1FBQzVCLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDckMsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFXLEVBQUUsSUFBeUMsRUFBRSxPQUF1QjtRQUNqRixPQUFPLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM3QyxDQUFDO0lBQ0QsUUFBUSxDQUFDLEdBQVc7UUFDaEIsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDL0MsQ0FBQztJQUNEOzs7T0FHRztJQUNHLElBQUksQ0FBQyxJQUFZLEVBQUUsT0FBZSxFQUFFLEdBQTZCLEVBQUUsS0FBNE07O1lBQ2pSLFNBQVM7WUFDVCxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQTtZQUM1Qix1QkFBdUI7WUFDdkIsTUFBTSxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLG1CQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDekQseUJBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUNuQixPQUFPLElBQUksQ0FBQTtRQUNmLENBQUM7S0FBQTtJQUNELGdFQUFnRTtJQUNoRTs7O01BR0U7SUFDRixLQUFLLENBQUMsT0FBNkI7UUFDL0IsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRDs7O01BR0U7SUFDRixLQUFLLENBQUMsSUFBYTtRQUNmLE9BQU8sU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQ7Ozs7O01BS0U7SUFDRixhQUFhLENBQUMsSUFBWSxFQUFFLEtBQXdCLEVBQUUsTUFBZTtRQUNqRSxPQUFPLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVEOzs7OztLQUtDO0lBQ0QsYUFBYSxDQUFDLElBQVksRUFBRSxLQUF3QixFQUFFLE1BQWU7UUFDakUsT0FBTyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU07UUFDRixPQUFPLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLO1FBQ0QsT0FBTyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUNELGlEQUFpRDtJQUNqRDs7O09BR0c7SUFDSCxRQUFRLENBQUMsT0FBZ0I7UUFDckIsT0FBTyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3RDLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVM7UUFDTCxPQUFPLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBQ0Q7O09BRUc7SUFDSCxRQUFRO1FBQ0osT0FBTyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUNEOzs7T0FHRztJQUNILFdBQVc7UUFDUCxPQUFPLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUNsQyxDQUFDO0lBQ0Q7O01BRUU7SUFDRixZQUFZO1FBQ1IsT0FBTyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDcEMsQ0FBQztJQUNEOztPQUVHO0lBQ0gsV0FBVztRQUNQLE9BQU8sU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRCxTQUFTO1FBQ0wsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQztJQUVELDhEQUE4RDtJQUM5RDs7Ozs7O09BTUc7SUFDSCxXQUFXLENBQ1AsRUFBRSxPQUFPLEVBQ0wsSUFBSSxFQUNKLFNBQVMsRUFDVCxRQUFRLEdBQUcsRUFBRSxFQUNiLEdBQUcsR0FBRyxLQUFLLEVBQ1gsV0FBVyxHQUFHLGlCQUFpQixFQUMvQixLQUFLLEdBQUcsV0FBVyxFQUNuQixPQUFPLEdBQUcsT0FBTyxFQUNqQixRQUFRLEdBQUc7UUFDUCxrQkFBa0I7S0FDckIsRUFBRSxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBa0I7UUFFM0MsSUFBSSxNQUFNLEdBQUc7WUFDVCxpQkFBaUIsRUFBRTtnQkFDZixJQUFJLEVBQUU7b0JBQ0YsV0FBVyxFQUFFLFdBQVc7b0JBQ3hCLEtBQUssRUFBRSxLQUFLO29CQUNaLE9BQU8sRUFBRSxPQUFPO2lCQUNuQjtnQkFDRCxJQUFJLEVBQUUsSUFBSSxJQUFJLGNBQVMsQ0FBQyxNQUFNLENBQUM7Z0JBQy9CLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixRQUFRLEVBQUUsUUFBUTtnQkFDbEIsT0FBTyxFQUFFLE9BQU87Z0JBQ2hCLG1CQUFtQixFQUFFO29CQUNqQixHQUFHLEVBQUU7d0JBQ0QsSUFBSSxFQUFFLFFBQVE7d0JBQ2QsRUFBRSxFQUFFLFFBQVE7d0JBQ1osSUFBSSxFQUFFLGVBQWU7d0JBQ3JCLFdBQVcsRUFBRSxFQUFFO3FCQUNsQjtpQkFDSjthQUNKO1lBQ0QsS0FBSyxFQUFFO2dCQUNILEdBQUcsRUFBRSxVQUFVO2dCQUNmLElBQUksRUFBRSxlQUFlO2FBQ3hCO1lBQ0QsT0FBTyxFQUFFLE9BQU8sSUFBSSxPQUFPLENBQUMsR0FBRyxFQUFFO1lBQ2pDLEtBQUssRUFBRSxDQUFDLFdBQUksQ0FBQyxTQUFTLElBQUksT0FBTyxFQUFFLE9BQU8sR0FBRyxDQUFDLEdBQUcsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsK0JBQStCO1NBQ2hHLENBQUE7UUFFRCxJQUFJO1lBQ0EsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLDJCQUEyQixDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzFFLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtTQUN6QjtRQUNELE9BQU8sQ0FBQyxFQUFFO1lBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLFlBQVksS0FBSyxDQUFDLEVBQUU7Z0JBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsMERBQTBELEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFBO2FBQzNJO1NBQ0o7SUFDTCxDQUFDO0NBQ0osQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcclxuZXhwb3J0IHsgV2ViSGFuZGxlLCBTZVBhcmFtQ29uZmlnVHlwZSB9IGZyb20gXCIuL3dlYkhhbmRsZVwiO1xyXG5leHBvcnQgeyBJUHJveHlPcHRpb25zIH0gZnJvbSBcIi4vc2VydmVyXCI7XHJcbmV4cG9ydCB7IGh0dHBfcXVlc3QgfSBmcm9tIFwiLi9IdHRwUXVlc3RcIjtcclxuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gXCJleHByZXNzXCJcclxuaW1wb3J0IHsgSVByb3h5T3B0aW9ucywgV2ViUm91dGVVbml0IH0gZnJvbSBcIi4vc2VydmVyXCI7XHJcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgc3RhcnQgfSBmcm9tIFwiLi9jb21tb25Sb3V0ZVwiO1xyXG5pbXBvcnQgeyBXZWJIYW5kbGUsIFNlUGFyYW1Db25maWdUeXBlIH0gZnJvbSAnLi93ZWJIYW5kbGUnO1xyXG5pbXBvcnQgeyBsb2FkTW9kdWxlIH0gZnJvbSAnLi9sb2FkV2ViRmlsZXMnO1xyXG5pbXBvcnQgeyBJUEZpbmRPbmUgfSBmcm9tICcuL2lwJztcclxuXHJcbnZhciBpbnN0YW5jZTogV2ViUm91dGVVbml0ID0gbmV3IFdlYlJvdXRlVW5pdCgpO1xyXG52YXIgd2ViSGFuZGxlOiBXZWJIYW5kbGUgPSBuZXcgV2ViSGFuZGxlKCk7XHJcblxyXG5cclxuaW50ZXJmYWNlIFN3YWdnZXJPcHRpb25zIHtcclxuICAgIHJvdXRlUGF0aDogc3RyaW5nO1xyXG4gICAgYmFzZWRpcjogc3RyaW5nO1xyXG4gICAgZXh0Pzogc3RyaW5nLFxyXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XHJcbiAgICB0aXRsZT86IHN0cmluZztcclxuICAgIHZlcnNpb24/OiBzdHJpbmc7XHJcbiAgICBob3N0Pzogc3RyaW5nO1xyXG4gICAgYmFzZVBhdGg/OiBzdHJpbmc7XHJcbiAgICBwcm9kdWNlcz86IHN0cmluZ1tdO1xyXG4gICAgc2NoZW1lcz86IHN0cmluZ1tdO1xyXG59XHJcblxyXG4vKipcclxuICog6L+Z6YeM6LSf6LSjaHR0cOeahOino+aekO+8jOeEtuWQjuS8oOmAkue7meWvueS6jueahOWkhOeQhuaWueazlSBcclxuICog55uu5YmN5q+U6L6D566A6ZmL77yM5ZCO57ut6ZyA6KaB5aKe5Yqg5LiA5LiL5aSE55CGXHJcbiAqIFxyXG4gKiBlbnZCZWZvcmUgLT4gZ2xvYmFsQmVmb3JlIC0+IGJlZm9yZSAtPiByb3V0ZSAtPiBhZnRlciAtPiBnbG9iYWxBZnRlciAtPiBlbnZBZnRlclxyXG4gKiBcclxuICovXHJcbmV4cG9ydCB2YXIgV2ViUm91dGVNb2R1bGUgPSB7XHJcbiAgICBuYW1lOiAnV2ViUm91dGVNb2R1bGUnLFxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKblvIDlkK/ot6jln59cclxuICAgICAqL1xyXG4gICAgb3BlbkNyb3NzKCkge1xyXG4gICAgICAgIGluc3RhbmNlLmVuYWJsZShcImNyb3NzXCIpXHJcbiAgICB9LFxyXG4gICAgLy8g6I635Y+W6LWE5rqQ5a6e5L6LXHJcbiAgICBnZXRBcHAoKSB7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlLmFwcDtcclxuICAgIH0sXHJcbiAgICAvLyDlvIDlp4vpnZnmgIHotYTmupDnm67lvZVcclxuICAgIHN0YXRpYyhwcmU6IHN0cmluZywgcm9vdDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnN0YXRpYyhwcmUsIHJvb3QpXHJcbiAgICB9LFxyXG5cclxuICAgIHByb3h5KHByZTogc3RyaW5nLCBob3N0OiBzdHJpbmcgfCAoKHJlcTogUmVxdWVzdCkgPT4gc3RyaW5nKSwgb3B0aW9ucz86IElQcm94eU9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gaW5zdGFuY2UucHJveHkocHJlLCBob3N0LCBvcHRpb25zKVxyXG4gICAgfSxcclxuICAgIHNldHByb3h5KGlwczogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlLmFwcC5zZXQoXCJ0cnVzdCBwcm94eVwiLCBpcHMpXHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vljJbmqKHlnZdcclxuICAgICAqIEBwYXJhbSBwb3J0IFxyXG4gICAgICovXHJcbiAgICBhc3luYyBpbml0KHBvcnQ6IG51bWJlciwgd2ViUGF0aDogc3RyaW5nLCBlbnY/OiBzdHJpbmcgfCAoKCkgPT4gc3RyaW5nKSwgbGltaXQ/OiBzdHJpbmcgfCB7IFt4OiBzdHJpbmddOiBzdHJpbmcgfCBib29sZWFuIHwgdW5kZWZpbmVkOyBnemlwPzogYm9vbGVhbjsganNvbj86IHN0cmluZyB8IHVuZGVmaW5lZDsgdGV4dD86IHN0cmluZyB8IHVuZGVmaW5lZDsgcmF3Pzogc3RyaW5nIHwgdW5kZWZpbmVkOyB1cmxlbmNvZGVkPzogc3RyaW5nIHwgdW5kZWZpbmVkOyB9IHwgdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgLy8g5YWI5Yid5aeL5YyW5qih5Z2XXHJcbiAgICAgICAgd2ViSGFuZGxlLmluaXQod2ViUGF0aCwgZW52KVxyXG4gICAgICAgIC8vIOi/memHjOmcgOimgeWinuWKoOS4gOS4quaLiei1t+aJgOacieeahOaooeWdl+aWh+S7tueahOWKn+iDvVxyXG4gICAgICAgIGF3YWl0IGluc3RhbmNlLmluaXQocG9ydCwgW3N0YXJ0LmJpbmQod2ViSGFuZGxlKV0sIGxpbWl0KVxyXG4gICAgICAgIGxvYWRNb2R1bGUod2ViUGF0aClcclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSxcclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8qKlxyXG4gICAgKiDms6jlhozmqKHlnZdcclxuICAgICogQHBhcmFtIHByZVBhdGgg5qih5Z2X55qE5YmN57yA6K+NIOS+i+WmgiAvYS9iIOeahOWJjee8gOWwseaYryAvYSDmiJbogIUvYS9cclxuICAgICovXHJcbiAgICBjbGFzcyhwcmVQYXRoPzogc3RyaW5nIHwgTm9kZU1vZHVsZSk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLmNsYXNzKHByZVBhdGgpXHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDms6jlhozot6/nlLFcclxuICAgICogQHBhcmFtIE5hbWUg5ZCO57yA6K+NIOS+i+WmgiAvYS9iIOeahOWQjue8gOWwseaYryBiIOaIluiAhS9iXHJcbiAgICAqL1xyXG4gICAgcm91dGUoTmFtZT86IHN0cmluZyk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5yb3V0ZShOYW1lKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAqIOajgOafpeWPguaVsFxyXG4gICAgKiBAcGFyYW0gbmFtZSDlj4LmlbDlkI3lrZdcclxuICAgICogQHBhcmFtIHNUeXBlIOWPguaVsOexu+Wei1xyXG4gICAgKiBAcGFyYW0gW2NoYW5nZV0g5piv5ZCm5by65Yi26L2s5o2i57G75Z6LIFxyXG4gICAgKi9cclxuICAgIHBhcmFtUmVxdWlyZWQobmFtZTogc3RyaW5nLCBzVHlwZTogU2VQYXJhbUNvbmZpZ1R5cGUsIGNoYW5nZTogYm9vbGVhbik6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5wYXJhbXMobmFtZSwgc1R5cGUsIHRydWUsIGNoYW5nZSk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAqIOajgOafpeWPguaVsFxyXG4gICAqIEBwYXJhbSBuYW1lIOWPguaVsOWQjeWtl1xyXG4gICAqIEBwYXJhbSBzVHlwZSDlj4LmlbDnsbvlnotcclxuICAgKiBAcGFyYW0gW2NoYW5nZV0g5piv5ZCm5by65Yi26L2s5o2i57G75Z6LIFxyXG4gICAqL1xyXG4gICAgcGFyYW1PcHRpb25hbChuYW1lOiBzdHJpbmcsIHNUeXBlOiBTZVBhcmFtQ29uZmlnVHlwZSwgY2hhbmdlOiBib29sZWFuKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLnBhcmFtcyhuYW1lLCBzVHlwZSwgZmFsc2UsIGNoYW5nZSk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5Z2X5pa55rOV6LCD55So5YmN55qE6LCD55So77yM5Li76KaB5piv57uZ5pWw5o2u5aSE55CG5o+Q5L6b5YmN572u5YeG5aSHXHJcbiAgICAgKi9cclxuICAgIGJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuYmVmb3JlKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5Z2X5pa55rOV6LCD55So5ZCO6LCD55So77yM5Li76KaB5piv57uZ5pWw5o2u5aSE55CG5o+Q5L6b5pyA5ZCO55qE5pON5L2cXHJcbiAgICAgKi9cclxuICAgIGFmdGVyKCk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5hZnRlcigpO1xyXG4gICAgfSxcclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8qKlxyXG4gICAgICog5rOo5YaM546v5aKD5aSE55CG5qih5Z2XXHJcbiAgICAgKiBAcGFyYW0gZXZuTmFtZSDnjq/looPlkI3lrZdcclxuICAgICAqL1xyXG4gICAgZW52Q2xhc3MoZXZuTmFtZT86IHN0cmluZyk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLmVudkNsYXNzKGV2bk5hbWUpXHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5a+55bqU546v5aKD5LiL5YWI6LCD55SoXHJcbiAgICAgKi9cclxuICAgIGVudkJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuZW52QmVmb3JlKCk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiDlr7nlupTnjq/looPkuIvlpITnkIblkI7osIPnlKhcclxuICAgICAqL1xyXG4gICAgZW52QWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLmVudkFmdGVyKCk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiDms6jlhoznjq/looPlpITnkIbmqKHlnZdcclxuICAgICAqIEBwYXJhbSBldm5OYW1lIOeOr+Wig+WQjeWtl1xyXG4gICAgICovXHJcbiAgICBnbG9iYWxDbGFzcygpOiBDbGFzc0RlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5nbG9iYWxDbGFzcygpXHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAqIFxyXG4gICAgKi9cclxuICAgIGdsb2JhbEJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuZ2xvYmFsQmVmb3JlKCk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqL1xyXG4gICAgZ2xvYmFsQWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLmdsb2JhbEFmdGVyKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldEhhbmRsZSgpIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlO1xyXG4gICAgfSxcclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5byA5ZCvU3dhZ2dlcuaooeWdl1xyXG4gICAgICogQGRhdGUgMjAyMC0wMS0xNlxyXG4gICAgICogQHBhcmFtIHt7IGJhc2VkaXI6IHN0cmluZzsgcm91dGVQYXRoOiBzdHJpbmc7IGRlc2NyaXB0aW9uPzogc3RyaW5nOyB0aXRsZT86IHN0cmluZzsgdmVyc2lvbj86IHN0cmluZzsgaG9zdD86IHN0cmluZzsgYmFzZVBhdGg/OiBzdHJpbmc7IHByb2R1Y2VzPzogc3RyaW5nW107IHNjaGVtZXM/OiBzdHJpbmdbXTsgfX0geyBiYXNlZGlyLCBqc1BhdGgsIGRlc2NyaXB0aW9uID0gJ1RoaXMgaXMgYSBzYW1wbGUgc2VydmVyJywgdGl0bGUgPSAnU3dhZ2dlcicsIHZlcnNpb24gPSAnMS4wLjAnLCBob3N0ID0gJ2xvY2FsaG9zdCcsIGJhc2VQYXRoID0gJycsIHByb2R1Y2VzID0gW1xyXG4gICAgICogICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICAgICAqICAgICAgICAgXSwgc2NoZW1lcyA9IFsnaHR0cCddIH1cclxuICAgICAqL1xyXG4gICAgb3BlblN3YWdnZXIoXHJcbiAgICAgICAgeyBiYXNlZGlyLFxyXG4gICAgICAgICAgICBob3N0LFxyXG4gICAgICAgICAgICByb3V0ZVBhdGgsXHJcbiAgICAgICAgICAgIGJhc2VQYXRoID0gJycsXHJcbiAgICAgICAgICAgIGV4dCA9IFwiLmpzXCIsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ2h0dHAgYXBpIHNlcnZlcicsXHJcbiAgICAgICAgICAgIHRpdGxlID0gJ2RyZWFtZHVrZScsXHJcbiAgICAgICAgICAgIHZlcnNpb24gPSAnMS4wLjAnLFxyXG4gICAgICAgICAgICBwcm9kdWNlcyA9IFtcclxuICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgICAgICAgICAgIF0sIHNjaGVtZXMgPSBbJ2h0dHAnXSB9OiBTd2FnZ2VyT3B0aW9ucyxcclxuICAgICkge1xyXG4gICAgICAgIGxldCBvcHRpb24gPSB7XHJcbiAgICAgICAgICAgIHN3YWdnZXJEZWZpbml0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICBpbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaG9zdDogaG9zdCB8fCBJUEZpbmRPbmUoXCJJUHY0XCIpLFxyXG4gICAgICAgICAgICAgICAgYmFzZVBhdGg6IGJhc2VQYXRoLFxyXG4gICAgICAgICAgICAgICAgcHJvZHVjZXM6IHByb2R1Y2VzLFxyXG4gICAgICAgICAgICAgICAgc2NoZW1lczogc2NoZW1lcyxcclxuICAgICAgICAgICAgICAgIHNlY3VyaXR5RGVmaW5pdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICBKV1Q6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2FwaUtleScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiAnaGVhZGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0F1dGhvcml6YXRpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJvdXRlOiB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvc3dhZ2dlcicsXHJcbiAgICAgICAgICAgICAgICBkb2NzOiAnL3N3YWdnZXIuanNvbicsICAgIC8vc3dhZ2dlcuaWh+S7tiBhcGlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYmFzZWRpcjogYmFzZWRpciB8fCBwcm9jZXNzLmN3ZCgpLCAvL2FwcCBhYnNvbHV0ZSBwYXRoXHJcbiAgICAgICAgICAgIGZpbGVzOiBbam9pbihyb3V0ZVBhdGggfHwgJy4vd2ViJywgJy8qKi8qJyArIChleHQgfHwgXCIuanNcIikpXSAvL1BhdGggdG8gdGhlIEFQSSBoYW5kbGUgZm9sZGVyXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBleHByZXNzU3dhZ2dlciA9IHJlcXVpcmUoJ2V4cHJlc3Mtc3dhZ2dlci1nZW5lcmF0b3InKShpbnN0YW5jZS5hcHApO1xyXG4gICAgICAgICAgICBleHByZXNzU3dhZ2dlcihvcHRpb24pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIChlIGluc3RhbmNlb2YgRXJyb3IpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb3BlbiBvcGVuU3dhZ2dlciBuZWVkIGluc3RhbGwgbm9kZV9tb2R1bGUgOiBucG0gaW5zdGFsbCAnICsgKGUubWVzc2FnZS5tYXRjaCgvXFwnLipcXCcvKSB8fCBbXSkuam9pbignICcpLnJlcGxhY2UoL1xcJy9nLCAnJykpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59XHJcbiJdfQ==